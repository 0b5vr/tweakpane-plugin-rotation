!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).TweakpaneRotationInputPlugin={})}(this,(function(t){"use strict";function e(t){return null==t}const i={alreadydisposed:()=>"View has been already disposed",invalidparams:t=>`Invalid parameters for '${t.name}'`,nomatchingcontroller:t=>`No matching controller for '${t.key}'`,nomatchingview:t=>`No matching view for '${JSON.stringify(t.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:t=>`Property '${t.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class n{constructor(t){var e;this.message=null!==(e=i[t.type](t.context))&&void 0!==e?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}static alreadyDisposed(){return new n({type:"alreadydisposed"})}static notBindable(){return new n({type:"notbindable"})}static propertyNotFound(t){return new n({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new n({type:"shouldneverhappen"})}}class s{constructor(){this.observers_={}}on(t,e){let i=this.observers_[t];return i||(i=this.observers_[t]=[]),i.push({handler:e}),this}off(t,e){const i=this.observers_[t];return i&&(this.observers_[t]=i.filter((t=>t.handler!==e))),this}emit(t,e){const i=this.observers_[t];i&&i.forEach((t=>{t.handler(e)}))}}const o="tp";function r(t){return(e,i)=>[o,"-",t,"v",e?`_${e}`:"",i?`-${i}`:""].join("")}function a(t){return t.rawValue}function l(t,e){var i,n;t.emitter.on("change",(i=a,n=e,t=>n(i(t)))),e(t.rawValue)}function h(t,e,i){l(t.value(e),i)}function c(t,e){return i=>{!function(t,e,i){i?t.classList.add(e):t.classList.remove(e)}(t,e,i)}}class u{constructor(t,e){var i;this.constraint_=null==e?void 0:e.constraint,this.equals_=null!==(i=null==e?void 0:e.equals)&&void 0!==i?i:(t,e)=>t===e,this.emitter=new s,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const i=null!=e?e:{forceEmit:!1,last:!0},n=this.constraint_?this.constraint_.constrain(t):t;(!this.equals_(this.rawValue_,n)||i.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=n,this.emitter.emit("change",{options:i,rawValue:n,sender:this}))}}class d{constructor(t){this.emitter=new s,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const i=null!=e?e:{forceEmit:!1,last:!0};(this.value_!==t||i.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:i,rawValue:this.value_,sender:this}))}}function p(t,e){const i=null==e?void 0:e.constraint,n=null==e?void 0:e.equals;return i||n?new u(t,e):new d(t)}class m{constructor(t){this.emitter=new s,this.valMap_=t;for(const t in this.valMap_){this.valMap_[t].emitter.on("change",(()=>{this.emitter.emit("change",{key:t,sender:this})}))}}static createCore(t){return Object.keys(t).reduce(((e,i)=>Object.assign(e,{[i]:p(t[i])})),{})}static fromObject(t){const e=this.createCore(t);return new m(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}}function v(t){return e=>i=>{if(!e&&void 0===i)return{succeeded:!1,value:void 0};if(e&&void 0===i)return{succeeded:!0,value:void 0};const n=t(i);return void 0!==n?{succeeded:!0,value:n}:{succeeded:!1,value:void 0}}}function _(t){return{custom:e=>v(e)(t),boolean:v((t=>"boolean"==typeof t?t:void 0))(t),number:v((t=>"number"==typeof t?t:void 0))(t),string:v((t=>"string"==typeof t?t:void 0))(t),function:v((t=>"function"==typeof t?t:void 0))(t),constant:e=>v((t=>t===e?e:void 0))(t),raw:v((t=>t))(t),object:e=>v((t=>{var i;if(null!==(i=t)&&"object"==typeof i)return function(t,e){return Object.keys(e).reduce(((i,n)=>{if(void 0===i)return;const s=(0,e[n])(t[n]);return s.succeeded?Object.assign(Object.assign({},i),{[n]:s.value}):void 0}),{})}(t,e)}))(t),array:e=>v((t=>{var i;if(Array.isArray(t))return i=e,t.reduce(((t,e)=>{if(void 0===t)return;const n=i(e);return n.succeeded&&void 0!==n.value?[...t,n.value]:void 0}),[])}))(t)}}const w={optional:_(!0),required:_(!1)};const g="http://www.w3.org/2000/svg";function f(t){t.offsetHeight}class x extends m{constructor(t){super(t)}static create(t){const e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=m.createCore(e);return new x(i)}get styleExpanded(){var t;return null!==(t=this.get("temporaryExpanded"))&&void 0!==t?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!e(t)?`${t}px`:"auto"}bindExpandedClass(t,e){h(this,"expanded",(()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)}))}}function y(t,e){e.style.height=t.styleHeight}function b(t,i){t.value("expanded").emitter.on("beforechange",(()=>{t.set("completed",!1),e(t.get("expandedHeight"))&&t.set("expandedHeight",function(t,e){let i=0;return function(t,e){const i=t.style.transition;t.style.transition="none",e(),t.style.transition=i}(e,(()=>{t.set("expandedHeight",null),t.set("temporaryExpanded",!0),f(e),i=e.clientHeight,t.set("temporaryExpanded",null),f(e)})),i}(t,i)),t.set("shouldFixHeight",!0),f(i)})),t.emitter.on("change",(()=>{y(t,i)})),y(t,i),i.addEventListener("transitionend",(e=>{"height"===e.propertyName&&(t.set("shouldFixHeight",!1),t.set("expandedHeight",null),t.set("completed",!0))}))}class z{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce(((t,e)=>e.constrain(t)),t)}}function C(t,e){if(t instanceof e)return t;if(t instanceof z){const i=t.constraints.reduce(((t,i)=>t||(i instanceof e?i:null)),null);if(i)return i}return null}class A{constructor(t){this.maxValue=t.max,this.minValue=t.min}constrain(t){let i=t;return e(this.minValue)||(i=Math.max(i,this.minValue)),e(this.maxValue)||(i=Math.min(i,this.maxValue)),i}}class E{constructor(t){this.step=t}constrain(t){return(t<0?-Math.round(-t/this.step):Math.round(t/this.step))*this.step}}const L=r("pop");class M{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(L()),e.viewProps.bindClassModifiers(this.element),l(e.shows,c(this.element,L(void 0,"v")))}}class P{constructor(t,e){this.shows=p(!1),this.viewProps=e.viewProps,this.view=new M(t,{shows:this.shows,viewProps:this.viewProps})}}class V{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const k={"**":(t,e)=>Math.pow(t,e),"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"&":(t,e)=>t&e,"^":(t,e)=>t^e,"|":(t,e)=>t|e};class B{constructor(t,e,i){this.left=e,this.operator=t,this.right=i}evaluate(){const t=k[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const F={"+":t=>t,"-":t=>-t,"~":t=>~t};class S{constructor(t,e){this.operator=t,this.expression=e}evaluate(){const t=F[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function R(t){return(e,i)=>{for(let n=0;n<t.length;n++){const s=t[n](e,i);if(""!==s)return s}return""}}function D(t,e){var i;const n=t.substr(e).match(/^\s+/);return null!==(i=n&&n[0])&&void 0!==i?i:""}function K(t,e){var i;const n=t.substr(e).match(/^[0-9]+/);return null!==(i=n&&n[0])&&void 0!==i?i:""}function j(t,e){const i=t.substr(e,1);if(e+=1,"e"!==i.toLowerCase())return"";const n=function(t,e){const i=K(t,e);if(""!==i)return i;const n=t.substr(e,1);if("-"!==n&&"+"!==n)return"";const s=K(t,e+=1);return""===s?"":n+s}(t,e);return""===n?"":i+n}function N(t,e){const i=t.substr(e,1);if("0"===i)return i;const n=function(t,e){const i=t.substr(e,1);return i.match(/^[1-9]$/)?i:""}(t,e);return e+=n.length,""===n?"":n+K(t,e)}const I=R([function(t,e){const i=N(t,e);if(e+=i.length,""===i)return"";const n=t.substr(e,1);if(e+=n.length,"."!==n)return"";const s=K(t,e);return i+n+s+j(t,e+=s.length)},function(t,e){const i=t.substr(e,1);if(e+=i.length,"."!==i)return"";const n=K(t,e);return e+=n.length,""===n?"":i+n+j(t,e)},function(t,e){const i=N(t,e);return e+=i.length,""===i?"":i+j(t,e)}]);const q=R([function(t,e){const i=t.substr(e,2);if(e+=i.length,"0b"!==i.toLowerCase())return"";const n=function(t,e){var i;const n=t.substr(e).match(/^[01]+/);return null!==(i=n&&n[0])&&void 0!==i?i:""}(t,e);return""===n?"":i+n},function(t,e){const i=t.substr(e,2);if(e+=i.length,"0o"!==i.toLowerCase())return"";const n=function(t,e){var i;const n=t.substr(e).match(/^[0-7]+/);return null!==(i=n&&n[0])&&void 0!==i?i:""}(t,e);return""===n?"":i+n},function(t,e){const i=t.substr(e,2);if(e+=i.length,"0x"!==i.toLowerCase())return"";const n=function(t,e){var i;const n=t.substr(e).match(/^[0-9a-f]+/i);return null!==(i=n&&n[0])&&void 0!==i?i:""}(t,e);return""===n?"":i+n}]),T=R([q,I]);function $(t,e){return function(t,e){const i=T(t,e);return e+=i.length,""===i?null:{evaluable:new V(i),cursor:e}}(t,e)||function(t,e){const i=t.substr(e,1);if(e+=i.length,"("!==i)return null;const n=X(t,e);if(!n)return null;e=n.cursor,e+=D(t,e).length;const s=t.substr(e,1);return e+=s.length,")"!==s?null:{evaluable:n.evaluable,cursor:e}}(t,e)}function H(t,e,i){i+=D(e,i).length;const n=t.filter((t=>e.startsWith(t,i)))[0];return n?(i+=n.length,{cursor:i+=D(e,i).length,operator:n}):null}const U=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((t,e)=>function(t,e){return(i,n)=>{const s=t(i,n);if(!s)return null;n=s.cursor;let o=s.evaluable;for(;;){const s=H(e,i,n);if(!s)break;n=s.cursor;const r=t(i,n);if(!r)return null;n=r.cursor,o=new B(s.operator,o,r.evaluable)}return o?{cursor:n,evaluable:o}:null}}(t,e)),(function t(e,i){const n=$(e,i);if(n)return n;const s=e.substr(i,1);if(i+=s.length,"+"!==s&&"-"!==s&&"~"!==s)return null;const o=t(e,i);return o?{cursor:i=o.cursor,evaluable:new S(s,o.evaluable)}:null}));function X(t,e){return e+=D(t,e).length,U(t,e)}function Y(t){var e;const i=function(t){const e=X(t,0);return e?e.cursor+D(t,e.cursor).length!==t.length?null:e.evaluable:null}(t);return null!==(e=null==i?void 0:i.evaluate())&&void 0!==e?e:null}function O({primary:t,secondary:e,forward:i,backward:n}){let s=!1;function o(t){s||(s=!0,t(),s=!1)}t.emitter.on("change",(n=>{o((()=>{e.setRawValue(i(t,e),n.options)}))})),e.emitter.on("change",(s=>{o((()=>{t.setRawValue(n(t,e),s.options)})),o((()=>{e.setRawValue(i(t,e),s.options)}))})),o((()=>{e.setRawValue(i(t,e),{forceEmit:!1,last:!0})}))}function Z(t,e){const i=t*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+i:e.downKey?-i:0}function Q(t){return{altKey:t.altKey,downKey:"ArrowDown"===t.key,shiftKey:t.shiftKey,upKey:"ArrowUp"===t.key}}function J(t,e){const i=e.ownerDocument.defaultView,n=e.getBoundingClientRect();return{x:t.pageX-((i&&i.scrollX||0)+n.left),y:t.pageY-((i&&i.scrollY||0)+n.top)}}class W{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new s,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),null===(e=t.currentTarget)||void 0===e||e.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(J(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(J(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(J(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){const e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;const i=null!==(e=t.targetTouches.item(0))&&void 0!==e?e:this.lastTouch_,n=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(i?{x:i.clientX-n.left,y:i.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey})}}function G(t){return String(t.toFixed(10)).split(".")[1].replace(/0+$/,"").length}const tt=r("txt");class et{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(tt(),tt(void 0,"num")),e.arrayPosition&&this.element.classList.add(tt(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("input");i.classList.add(tt("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(tt()),this.inputElement.classList.add(tt("i"));const n=t.createElement("div");n.classList.add(tt("k")),this.element.appendChild(n),this.knobElement=n;const s=t.createElementNS(g,"svg");s.classList.add(tt("g")),this.knobElement.appendChild(s);const o=t.createElementNS(g,"path");o.classList.add(tt("gb")),s.appendChild(o),this.guideBodyElem_=o;const a=t.createElementNS(g,"path");a.classList.add(tt("gh")),s.appendChild(a),this.guideHeadElem_=a;const l=t.createElement("div");l.classList.add(r("tt")()),this.knobElement.appendChild(l),this.tooltipElem_=l,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(null===t.rawValue)return void this.element.classList.remove(tt(void 0,"drg"));this.element.classList.add(tt(void 0,"drg"));const e=t.rawValue/this.props_.get("draggingScale"),i=e+(e>0?-1:e<0?1:0),n=(s=-i,o=-4,r=4,Math.min(Math.max(s,o),r));var s,o,r;this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+n},0 L${i},4 L${i+n},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);const a=this.props_.get("formatter");this.tooltipElem_.textContent=a(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class it{constructor(t,e){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=p(null),this.view=new et(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const i=new W(this.view.knobElement);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}onInputChange_(t){const i=t.currentTarget.value,n=this.parser_(i);e(n)||(this.value.rawValue=n),this.view.refresh()}onInputKeyDown_(t){const e=Z(this.baseStep_,Q(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onInputKeyUp_(t){0!==Z(this.baseStep_,Q(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const e=t.point.x-t.bounds.width/2;return this.originRawValue_+e*this.props.get("draggingScale")}onPointerMove_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}function nt(t){if("inline"===t||"popup"===t)return t}function st(t){const e=w;return e.required.object({max:e.optional.number,min:e.optional.number,step:e.optional.number})(t).value}function ot(t,e){const i=t&&C(t,E);return i?G(i.step):Math.max(G(e),2)}function rt(t){const e=function(t){const e=t?C(t,E):null;return e?e.step:null}(t);return null!=e?e:1}function at(t,e){var i;const n=t&&C(t,E),s=Math.abs(null!==(i=null==n?void 0:n.step)&&void 0!==i?i:e);return 0===s?.1:Math.pow(10,Math.floor(Math.log10(s))-1)}class lt{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){const e=this.asm_.toComponents(t).map(((t,e)=>{var i,n;return null!==(n=null===(i=this.components[e])||void 0===i?void 0:i.constrain(t))&&void 0!==n?n:t}));return this.asm_.fromComponents(e)}}const ht=r("pndtxt");class ct{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(ht()),this.textViews.forEach((e=>{const i=t.createElement("div");i.classList.add(ht("a")),i.appendChild(e.element),this.element.appendChild(i)}))}}class ut{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map(((i,n)=>function(t,e,i){return new it(t,{arrayPosition:0===i?"fst":i===e.axes.length-1?"lst":"mid",baseStep:e.axes[i].baseStep,parser:e.parser,props:e.axes[i].textProps,value:p(0,{constraint:e.axes[i].constraint}),viewProps:e.viewProps})}(t,e,n))),this.acs_.forEach(((t,i)=>{O({primary:this.value,secondary:t.value,forward:t=>e.assembly.toComponents(t.rawValue)[i],backward:(t,n)=>{const s=e.assembly.toComponents(t.rawValue);return s[i]=n.rawValue,e.assembly.fromComponents(s)}})})),this.view=new ct(t,{textViews:this.acs_.map((t=>t.view))})}}class dt{constructor(t,e,i,n){this.x=null!=t?t:0,this.y=null!=e?e:0,this.z=null!=i?i:0,this.w=null!=n?n:1}static fromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return new dt(t.x*n,t.y*n,t.z*n,Math.cos(i))}static lookRotation(t,e){const{normal:i,tangent:n,binormal:s}=t.orthoNormalize(e),o=s.x,r=n.x,a=i.x,l=s.y,h=n.y,c=i.y,u=s.z,d=n.z,p=i.z,m=o+h+p;if(m>0){const t=.5/Math.sqrt(m+1);return new dt((d-c)*t,(a-u)*t,(l-r)*t,.25/t)}if(o>h&&o>p){const t=2*Math.sqrt(1+o-h-p);return new dt(.25*t,(r+l)/t,(a+u)/t,(d-c)/t)}if(h>p){const t=2*Math.sqrt(1+h-o-p);return new dt((r+l)/t,.25*t,(c+d)/t,(a-u)/t)}{const t=2*Math.sqrt(1+p-o-h);return new dt((a+u)/t,(c+d)/t,.25*t,(l-r)/t)}}getComponents(){return[this.x,this.y,this.z,this.w]}get lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}get length(){return Math.sqrt(this.lengthSq)}get normalized(){const t=this.length;return 0===t?new dt:new dt(this.x/t,this.y/t,this.z/t,this.w/t)}get negated(){return new dt(-this.x,-this.y,-this.z,-this.w)}get ban360s(){return this.w<0?this.negated:this}multiply(t){return new dt(this.w*t.x+this.x*t.w+this.y*t.z-this.z*t.y,this.w*t.y-this.x*t.z+this.y*t.w+this.z*t.x,this.w*t.z+this.x*t.y-this.y*t.x+this.z*t.w,this.w*t.w-this.x*t.x-this.y*t.y-this.z*t.z)}slerp(t,e){if(0===e)return this;if(1===e)return t;const i=this;let n=i.w*t.w+i.x*t.x+i.y*t.y+i.z*t.z;if(n<0&&(t=t.negated,n=-n),n>=1)return i;const s=1-n*n;if(s<=Number.EPSILON){const n=1-e;return new dt(n*i.x+e*t.x,n*i.y+e*t.y,n*i.z+e*t.z,n*i.w+e*t.w).normalized}const o=Math.sqrt(s),r=Math.atan2(o,n),a=Math.sin((1-e)*r)/o,l=Math.sin(e*r)/o;return new dt(i.x*a+t.x*l,i.y*a+t.y*l,i.z*a+t.z*l,i.w*a+t.w*l)}}class pt{constructor(){this.offset=[0,0,5],this.fov=30,this.aspect=1,this.viewport=[0,0,1,1]}project(t){const e=.5*(this.viewport[0]+this.viewport[2]),i=.5*(this.viewport[1]+this.viewport[3]),n=this.viewport[2]-this.viewport[0],s=this.viewport[3]-this.viewport[1],o=1/Math.tan(this.fov*Math.PI/360),r=t.z+this.offset[2];return[e+(t.x+this.offset[0])/r*o*n*.5/this.aspect,i-(t.y+this.offset[1])/r*o*s*.5]}}class mt{constructor(t,e,i){this.element=t.createElementNS(g,"path"),this.vertices=e,this.projector=i}setRotation(t){let e="";return this.vertices.forEach(((i,n)=>{const s=i.applyQuaternion(t),[o,r]=this.projector.project(s);e+=`${0===n?"M":"L"}${o} ${r}`})),this.element.setAttributeNS(null,"d",e),this}}class vt{constructor(t,e,i){this.x=null!=t?t:0,this.y=null!=e?e:0,this.z=null!=i?i:0}getComponents(){return[this.x,this.y,this.z]}get lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}get length(){return Math.sqrt(this.lengthSq)}get normalized(){const t=this.length;return 0===t?new vt:new vt(this.x/t,this.y/t,this.z/t)}get negated(){return new vt(-this.x,-this.y,-this.z)}add(t){return new vt(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return new vt(this.x-t.x,this.y-t.y,this.z-t.z)}scale(t){return new vt(this.x*t,this.y*t,this.z*t)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new vt(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}orthoNormalize(t){const e=this.normalized;t=t.normalized;let i=e.dot(t);1===i&&(t=Math.abs(e.y)>Math.abs(e.z)?new vt(0,0,1):new vt(0,1,0),i=e.dot(t));const n=(t=t.sub(e.scale(i)).normalized).cross(e);return{normal:e,tangent:t,binormal:n}}applyQuaternion(t){const e=t.w*this.x+t.y*this.z-t.z*this.y,i=t.w*this.y+t.z*this.x-t.x*this.z,n=t.w*this.z+t.x*this.y-t.y*this.x,s=-t.x*this.x-t.y*this.y-t.z*this.z;return new vt(e*t.w+s*-t.x+i*-t.z-n*-t.y,i*t.w+s*-t.y+n*-t.x-e*-t.z,n*t.w+s*-t.z+e*-t.y-i*-t.x)}}function _t(t,e){const i=e.z>0?new dt(0,0,0,1):new dt(0,0,1,0);return Math.abs(t.z)>.9999?i:dt.lookRotation(t,e)}function wt(t,e,i,n,s,o=1){const r=[];for(let a=0;a<i;a++){const l=t+e*a/(i-1),h=new vt;h[n]=o*Math.cos(l),h[s]=o*Math.sin(l),r.push(h)}return r}const gt=r("rotationgizmo"),ft=new vt(0,0,0),xt=new vt(1,0,0),yt=new vt(0,1,0),bt=new vt(0,0,1),zt=new vt(0,0,-1),Ct=new vt(.7,0,0),At=new vt(0,.7,0),Et=new vt(0,0,.7),Lt=new vt(-.7,0,0),Mt=new vt(0,-.7,0),Pt=new vt(0,0,-.7),Vt=new dt(0,0,0,1);function kt(t,e,i){const n=t.createElementNS(g,"g"),s=t.createElementNS(g,"circle");s.classList.add(gt(e)),s.setAttributeNS(null,"cx","0"),s.setAttributeNS(null,"cy","0"),s.setAttributeNS(null,"r","8"),n.appendChild(s);const o=t.createElementNS(g,"text");return o.classList.add(gt("labeltext")),o.setAttributeNS(null,"y","4"),o.setAttributeNS(null,"text-anchor","middle"),o.setAttributeNS(null,"font-size","10"),o.textContent=i,n.appendChild(o),n}class Bt{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.onModeChange_=this.onModeChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(gt()),"popup"===e.pickerLayout&&this.element.classList.add(gt(void 0,"p"));const i=t.createElement("div");i.classList.add(gt("p")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const n=t.createElementNS(g,"svg");n.classList.add(gt("g")),this.padElement.appendChild(n),this.svgElem_=n,this.projector_=new pt,this.projector_.viewport=[0,0,136,136];const s=wt(0,Math.PI,33,"x","y"),o=wt(0,2*Math.PI,65,"x","y",1.1);this.xArcB_=new mt(t,s,this.projector_),this.xArcB_.element.classList.add(gt("arcx")),this.svgElem_.appendChild(this.xArcB_.element),this.yArcB_=new mt(t,s,this.projector_),this.yArcB_.element.classList.add(gt("arcy")),this.svgElem_.appendChild(this.yArcB_.element),this.zArcB_=new mt(t,s,this.projector_),this.zArcB_.element.classList.add(gt("arcz")),this.svgElem_.appendChild(this.zArcB_.element),this.xArcBC_=new mt(t,s,this.projector_),this.xArcBC_.element.classList.add(gt("arcc")),this.svgElem_.appendChild(this.xArcBC_.element),this.yArcBC_=new mt(t,s,this.projector_),this.yArcBC_.element.classList.add(gt("arcc")),this.svgElem_.appendChild(this.yArcBC_.element),this.zArcBC_=new mt(t,s,this.projector_),this.zArcBC_.element.classList.add(gt("arcc")),this.svgElem_.appendChild(this.zArcBC_.element);const r=t.createElementNS(g,"g");n.classList.add(gt("axes")),this.svgElem_.appendChild(r),this.axesElem_=r,this.xAxis_=new mt(t,[ft,Ct],this.projector_),this.xAxis_.element.classList.add(gt("axisx")),this.axesElem_.appendChild(this.xAxis_.element),this.yAxis_=new mt(t,[ft,At],this.projector_),this.yAxis_.element.classList.add(gt("axisy")),this.axesElem_.appendChild(this.yAxis_.element),this.zAxis_=new mt(t,[ft,Et],this.projector_),this.zAxis_.element.classList.add(gt("axisz")),this.axesElem_.appendChild(this.zAxis_.element),this.xnAxis_=new mt(t,[ft,Lt],this.projector_),this.xnAxis_.element.classList.add(gt("axisn")),this.axesElem_.appendChild(this.xnAxis_.element),this.ynAxis_=new mt(t,[ft,Mt],this.projector_),this.ynAxis_.element.classList.add(gt("axisn")),this.axesElem_.appendChild(this.ynAxis_.element),this.znAxis_=new mt(t,[ft,Pt],this.projector_),this.znAxis_.element.classList.add(gt("axisn")),this.axesElem_.appendChild(this.znAxis_.element),this.xArcF_=new mt(t,s,this.projector_),this.xArcF_.element.classList.add(gt("arcx")),this.svgElem_.appendChild(this.xArcF_.element),this.yArcF_=new mt(t,s,this.projector_),this.yArcF_.element.classList.add(gt("arcy")),this.svgElem_.appendChild(this.yArcF_.element),this.zArcF_=new mt(t,s,this.projector_),this.zArcF_.element.classList.add(gt("arcz")),this.svgElem_.appendChild(this.zArcF_.element),this.xArcFC_=new mt(t,s,this.projector_),this.xArcFC_.element.classList.add(gt("arcc")),this.svgElem_.appendChild(this.xArcFC_.element),this.yArcFC_=new mt(t,s,this.projector_),this.yArcFC_.element.classList.add(gt("arcc")),this.svgElem_.appendChild(this.yArcFC_.element),this.zArcFC_=new mt(t,s,this.projector_),this.zArcFC_.element.classList.add(gt("arcc")),this.svgElem_.appendChild(this.zArcFC_.element),this.rArc_=new mt(t,o,this.projector_),this.rArc_.element.classList.add(gt("arcr")),this.rArc_.setRotation(Vt),this.svgElem_.appendChild(this.rArc_.element),this.rArcC_=new mt(t,o,this.projector_),this.rArcC_.element.classList.add(gt("arcc")),this.rArcC_.setRotation(Vt),this.svgElem_.appendChild(this.rArcC_.element);const a=t.createElementNS(g,"g");n.classList.add(gt("labels")),this.svgElem_.appendChild(a),this.labelsElem_=a,this.xLabel=kt(t,"labelcirclex","X"),this.labelsElem_.appendChild(this.xLabel),this.yLabel=kt(t,"labelcircley","Y"),this.labelsElem_.appendChild(this.yLabel),this.zLabel=kt(t,"labelcirclez","Z"),this.labelsElem_.appendChild(this.zLabel),this.xnLabel=kt(t,"labelcirclen","-X"),this.labelsElem_.appendChild(this.xnLabel),this.ynLabel=kt(t,"labelcirclen","-Y"),this.labelsElem_.appendChild(this.ynLabel),this.znLabel=kt(t,"labelcirclen","-Z"),this.labelsElem_.appendChild(this.znLabel);const l=()=>{this.xArcB_.element.classList.add(gt("arcx_hover")),this.xArcF_.element.classList.add(gt("arcx_hover"))},h=()=>{this.xArcB_.element.classList.remove(gt("arcx_hover")),this.xArcF_.element.classList.remove(gt("arcx_hover"))};this.xArcBC_.element.addEventListener("mouseenter",l),this.xArcBC_.element.addEventListener("mouseleave",h),this.xArcFC_.element.addEventListener("mouseenter",l),this.xArcFC_.element.addEventListener("mouseleave",h);const c=()=>{this.yArcB_.element.classList.add(gt("arcy_hover")),this.yArcF_.element.classList.add(gt("arcy_hover"))},u=()=>{this.yArcB_.element.classList.remove(gt("arcy_hover")),this.yArcF_.element.classList.remove(gt("arcy_hover"))};this.yArcBC_.element.addEventListener("mouseenter",c),this.yArcBC_.element.addEventListener("mouseleave",u),this.yArcFC_.element.addEventListener("mouseenter",c),this.yArcFC_.element.addEventListener("mouseleave",u);const d=()=>{this.zArcB_.element.classList.add(gt("arcz_hover")),this.zArcF_.element.classList.add(gt("arcz_hover"))},p=()=>{this.zArcB_.element.classList.remove(gt("arcz_hover")),this.zArcF_.element.classList.remove(gt("arcz_hover"))};this.zArcBC_.element.addEventListener("mouseenter",d),this.zArcBC_.element.addEventListener("mouseleave",p),this.zArcFC_.element.addEventListener("mouseenter",d),this.zArcFC_.element.addEventListener("mouseleave",p);this.rArcC_.element.addEventListener("mouseenter",(()=>{this.rArc_.element.classList.add(gt("arcr_hover"))})),this.rArcC_.element.addEventListener("mouseleave",(()=>{this.rArc_.element.classList.remove(gt("arcr_hover"))})),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,e.mode.emitter.on("change",this.onModeChange_),this.mode_=e.mode,this.update_()}get xArcBElement(){return this.xArcBC_.element}get yArcBElement(){return this.yArcBC_.element}get zArcBElement(){return this.zArcBC_.element}get xArcFElement(){return this.xArcFC_.element}get yArcFElement(){return this.yArcFC_.element}get zArcFElement(){return this.zArcFC_.element}get rArcElement(){return this.rArcC_.element}get allFocusableElements(){return[this.padElement]}update_(){const t=this.value.rawValue.normalized;this.xAxis_.setRotation(t),this.yAxis_.setRotation(t),this.zAxis_.setRotation(t),this.xnAxis_.setRotation(t),this.ynAxis_.setRotation(t),this.znAxis_.setRotation(t);const e=xt.applyQuaternion(t),i=yt.applyQuaternion(t),n=bt.applyQuaternion(t),s=e.negated,o=i.negated,r=n.negated;[{el:this.xAxis_.element,v:e},{el:this.yAxis_.element,v:i},{el:this.zAxis_.element,v:n},{el:this.xnAxis_.element,v:s},{el:this.ynAxis_.element,v:o},{el:this.znAxis_.element,v:r}].map((({el:t,v:e})=>(this.axesElem_.removeChild(t),{el:t,v:e}))).sort(((t,e)=>t.v.z-e.v.z)).forEach((({el:t})=>{this.axesElem_.appendChild(t)})),this.xArcB_.setRotation(_t(e,zt)),this.yArcB_.setRotation(_t(i,zt)),this.zArcB_.setRotation(_t(n,zt)),this.xArcBC_.setRotation(_t(e,zt)),this.yArcBC_.setRotation(_t(i,zt)),this.zArcBC_.setRotation(_t(n,zt)),this.xArcF_.setRotation(_t(e,bt)),this.yArcF_.setRotation(_t(i,bt)),this.zArcF_.setRotation(_t(n,bt)),this.xArcFC_.setRotation(_t(e,bt)),this.yArcFC_.setRotation(_t(i,bt)),this.zArcFC_.setRotation(_t(n,bt)),[{el:this.xLabel,v:Ct},{el:this.yLabel,v:At},{el:this.zLabel,v:Et},{el:this.xnLabel,v:Lt},{el:this.ynLabel,v:Mt},{el:this.znLabel,v:Pt}].forEach((({el:e,v:i})=>{const[n,s]=this.projector_.project(i.applyQuaternion(t));e.setAttributeNS(null,"transform",`translate( ${n}, ${s} )`)})),[{el:this.xLabel,v:e},{el:this.yLabel,v:i},{el:this.zLabel,v:n},{el:this.xnLabel,v:s},{el:this.ynLabel,v:o},{el:this.znLabel,v:r}].map((({el:t,v:e})=>(this.labelsElem_.removeChild(t),{el:t,v:e}))).sort(((t,e)=>t.v.z-e.v.z)).forEach((({el:t})=>{this.labelsElem_.appendChild(t)}))}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}onModeChange_(){const t=this.mode_.rawValue,e="angle-x"===t?"add":"remove",i="angle-y"===t?"add":"remove",n="angle-z"===t?"add":"remove",s="angle-r"===t?"add":"remove";this.xArcB_.element.classList[e](gt("arcx_active")),this.yArcB_.element.classList[i](gt("arcy_active")),this.zArcB_.element.classList[n](gt("arcz_active")),this.xArcF_.element.classList[e](gt("arcx_active")),this.yArcF_.element.classList[i](gt("arcy_active")),this.zArcF_.element.classList[n](gt("arcz_active")),this.rArc_.element.classList[s](gt("arcr_active"))}}function Ft(t){return function(t,e,i){return Math.min(Math.max(t,e),i)}(t,0,1)}function St(t,e){return t-function(t,e){return Math.floor(t/e)*e}(t,e)}function Rt(t){return St(t+Math.PI,2*Math.PI)-Math.PI}const Dt=1/Math.sqrt(2),Kt=new vt(1,0,0),jt=new vt(0,1,0),Nt=new vt(0,0,1),It=new dt(0,0,0,1),qt=new dt(Dt,0,0,Dt),Tt=new dt(0,-Dt,0,Dt),$t=new dt(-Dt,0,0,Dt),Ht=new dt(0,Dt,0,Dt),Ut=new dt(0,1,0,0);class Xt{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.mode_=p("free"),this.view=new Bt(t,{value:this.value,mode:this.mode_,viewProps:this.viewProps,pickerLayout:e.pickerLayout}),this.ptHandler_=new W(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_);const i=new W(this.view.xArcBElement);i.emitter.on("down",(()=>this.changeModeIfNotAuto_("angle-x"))),i.emitter.on("up",(()=>this.changeModeIfNotAuto_("free")));const n=new W(this.view.xArcFElement);n.emitter.on("down",(()=>this.changeModeIfNotAuto_("angle-x"))),n.emitter.on("up",(()=>this.changeModeIfNotAuto_("free")));const s=new W(this.view.yArcBElement);s.emitter.on("down",(()=>this.changeModeIfNotAuto_("angle-y"))),s.emitter.on("up",(()=>this.changeModeIfNotAuto_("free")));const o=new W(this.view.yArcFElement);o.emitter.on("down",(()=>this.changeModeIfNotAuto_("angle-y"))),o.emitter.on("up",(()=>this.changeModeIfNotAuto_("free")));const r=new W(this.view.zArcBElement);r.emitter.on("down",(()=>this.changeModeIfNotAuto_("angle-z"))),r.emitter.on("up",(()=>this.changeModeIfNotAuto_("free")));const a=new W(this.view.zArcFElement);a.emitter.on("down",(()=>this.changeModeIfNotAuto_("angle-z"))),a.emitter.on("up",(()=>this.changeModeIfNotAuto_("free")));const l=new W(this.view.rArcElement);l.emitter.on("down",(()=>this.changeModeIfNotAuto_("angle-r"))),l.emitter.on("up",(()=>this.changeModeIfNotAuto_("free"))),[{el:this.view.xLabel,q:Tt},{el:this.view.yLabel,q:qt},{el:this.view.zLabel,q:It},{el:this.view.xnLabel,q:Ht},{el:this.view.ynLabel,q:$t},{el:this.view.znLabel,q:Ut}].forEach((({el:t,q:e})=>{new W(t).emitter.on("down",(()=>this.autoRotate_(e)))})),this.px_=null,this.py_=null,this.angleState_=null}handlePointerEvent_(t){if(!t.point)return;const e=this.mode_.rawValue,i=t.point.x,n=t.point.y;if("auto"===e);else if("free"===e){if(null!=this.px_&&null!=this.py_){const t=i-this.px_,e=n-this.py_,s=Math.sqrt(t*t+e*e);if(0===s)return;const o=new vt(e/s,t/s,0),r=dt.fromAxisAngle(o,s/68);this.value.rawValue=r.multiply(this.value.rawValue)}this.px_=i,this.py_=n}else if("angle-r"===e){const e=t.bounds.width/2,s=t.bounds.height/2,o=Math.atan2(n-s,i-e);if(null==this.angleState_){const t=new vt(0,0,1);this.angleState_={initialRotation:this.value.rawValue,initialAngle:o,axis:t,reverseAngle:!0}}else{const{initialRotation:t,initialAngle:e,axis:i}=this.angleState_,n=-Rt(o-e),s=dt.fromAxisAngle(i,n);this.value.rawValue=s.multiply(t)}}else{const s=t.bounds.width/2,o=t.bounds.height/2,r=Math.atan2(n-o,i-s);if(null==this.angleState_){const t="angle-x"===e?Kt:"angle-y"===e?jt:Nt,i=t.applyQuaternion(this.value.rawValue).z>0;this.angleState_={initialRotation:this.value.rawValue,initialAngle:r,axis:t,reverseAngle:i}}else{const{initialRotation:t,initialAngle:e,axis:i,reverseAngle:n}=this.angleState_;let s=Rt(r-e);s=n?-s:s;const o=dt.fromAxisAngle(i,s);this.value.rawValue=t.multiply(o)}}}onPointerDown_(t){this.handlePointerEvent_(t.data)}onPointerMove_(t){this.handlePointerEvent_(t.data)}onPointerUp_(){this.px_=null,this.py_=null,this.angleState_=null}onPadKeyDown_(t){var e;(function(t){return"ArrowUp"===t||"ArrowDown"===t}(e=t.key)||"ArrowLeft"===e||"ArrowRight"===e)&&t.preventDefault()}changeModeIfNotAuto_(t){"auto"!==this.mode_.rawValue&&(this.mode_.rawValue=t)}autoRotate_(t){this.mode_.rawValue="auto";const e=this.value.rawValue.ban360s,i=Date.now(),n=()=>{const s=Date.now(),o=function(t){if(t<=0)return 0;if(t>=1)return 1;const e=1-t;return Ft(1-e*(e*(e*(e*(e*(e*(-6*e+7)))))))}(Ft((s-i-(r=0))/(300-r)));var r;this.value.rawValue=e.slerp(t,o),1!==o?requestAnimationFrame(n):this.mode_.rawValue="free"};requestAnimationFrame(n)}}const Yt={toComponents:t=>[t.x,t.y,t.z,t.w],fromComponents:t=>new dt(t[0],t[1],t[2],t[3])},Ot=r("rotationswatch");class Zt{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(Ot()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(Ot("sw")),this.element.appendChild(i),this.swatchElem_=i;const n=t.createElement("button");n.classList.add(Ot("b")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n,this.update_()}update_(){this.value.rawValue}onValueChange_(){this.update_()}}class Qt{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Zt(t,{value:this.value,viewProps:this.viewProps})}}const Jt=r("rotation");class Wt{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Jt()),e.foldable.bindExpandedClass(this.element,Jt(void 0,"expanded")),h(e.foldable,"completed",c(this.element,Jt(void 0,"cpl")));const i=t.createElement("div");i.classList.add(Jt("h")),this.element.appendChild(i);const n=t.createElement("div");n.classList.add(Jt("s")),i.appendChild(n),this.swatchElement=n;const s=t.createElement("div");if(s.classList.add(Jt("t")),i.appendChild(s),this.textElement=s,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(Jt("g")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}class Gt{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=x.create(e.expanded),this.swatchC_=new Qt(t,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new ut(t,{assembly:Yt,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new Wt(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===e.pickerLayout?new P(t,{viewProps:this.viewProps}):null;const n=new Xt(t,{value:this.value,viewProps:this.viewProps,pickerLayout:e.pickerLayout});n.view.allFocusableElements.forEach((t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)})),this.gizmoC_=n,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(n.view.element),O({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t.rawValue,backward:(t,e)=>e.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.gizmoC_.view.element),b(this.foldable_,this.view.pickerElement))}onButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,i=t.relatedTarget;i&&e.contains(i)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.gizmoC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,i=function(t){return t.relatedTarget?t.relatedTarget:"explicitOriginalTarget"in t?t.explicitOriginalTarget:null}(t);i&&e.contains(i)||(i&&i===this.swatchC_.view.buttonElement&&void 0===e.ownerDocument.ontouchstart||(this.popC_.shows.rawValue=!1))}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.swatchC_.view.buttonElement.focus()}}function te(t,e){return{baseStep:rt(e),constraint:e,textProps:m.fromObject({draggingScale:at(e,t),formatter:(i=ot(e,t),t=>t.toFixed(Math.max(Math.min(i,20),0)))})};var i}function ee(t){if(!t)return;const i=[];return e(t.step)||i.push(new E(t.step)),e(t.max)&&e(t.min)||i.push(new A({max:t.max,min:t.min})),new z(i)}function ie(t){var e,i,n,s;return"object"==typeof t&&("number"==typeof(null===(e=t)||void 0===e?void 0:e.x)&&"number"==typeof(null===(i=t)||void 0===i?void 0:i.y)&&"number"==typeof(null===(n=t)||void 0===n?void 0:n.z)&&"number"==typeof(null===(s=t)||void 0===s?void 0:s.w))}function ne(t){switch(t){case"eulerXYZ":case"eulerXZY":case"eulerYXZ":case"eulerYZX":case"eulerZXY":case"eulerZYX":case"quaternion":case"axisAngle":return t;default:return}}const se={id:"rotation",type:"input",css:".tp-rotationgizmov_p{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-rotationgizmov_p{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-rotationgizmov_p:hover{background-color:var(--in-bg-h)}.tp-rotationgizmov_p:focus{background-color:var(--in-bg-f)}.tp-rotationgizmov_p:active{background-color:var(--in-bg-a)}.tp-rotationgizmov_p:disabled{opacity:0.5}.tp-rotationv{position:relative}.tp-rotationv_root{background-color:var(--mo-bg);width:100%;height:calc( 2.0 * var(--bld-us))}.tp-rotationv_h{display:flex}.tp-rotationv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us);margin-right:4px}.tp-rotationv_g{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-rotationv.tp-rotationv-expanded .tp-rotationv_g{margin-top:var(--bld-s);opacity:1}.tp-rotationv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-rotationswatchv_sw{background-color:var(--btn-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-rotationswatchv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-rotationgizmov{padding-left:calc(var(--bld-us) + 4px)}.tp-rotationgizmov path{stroke-linecap:round;stroke-linejoin:round}.tp-rotationgizmov_p{cursor:move;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-rotationgizmov_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-rotationgizmov_axisx{stroke:#eb103f;stroke-width:2px}.tp-rotationgizmov_axisy{stroke:#4eeb10;stroke-width:2px}.tp-rotationgizmov_axisz{stroke:#1068eb;stroke-width:2px}.tp-rotationgizmov_axisn{stroke:var(--in-fg);stroke-width:2px}.tp-rotationgizmov_arcx{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcx.tp-rotationgizmov_arcx_hover{stroke:#eb103f}.tp-rotationgizmov_arcx.tp-rotationgizmov_arcx_active{stroke:#eb103f;stroke-width:2px}.tp-rotationgizmov_arcy{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcy.tp-rotationgizmov_arcy_hover{stroke:#4eeb10}.tp-rotationgizmov_arcy.tp-rotationgizmov_arcy_active{stroke:#4eeb10;stroke-width:2px}.tp-rotationgizmov_arcz{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcz.tp-rotationgizmov_arcz_hover{stroke:#1068eb}.tp-rotationgizmov_arcz.tp-rotationgizmov_arcz_active{stroke:#1068eb;stroke-width:2px}.tp-rotationgizmov_arcr{fill:none;stroke:var(--in-fg)}.tp-rotationgizmov_arcr.tp-rotationgizmov_arcr_hover{stroke:#ebd510}.tp-rotationgizmov_arcr.tp-rotationgizmov_arcr_active{stroke:#ebd510;stroke-width:2px}.tp-rotationgizmov_arcc{fill:none;stroke:transparent;stroke-width:5px;pointer-events:auto}.tp-rotationgizmov_labelcirclex{fill:#eb103f;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclex:hover{opacity:0.7}.tp-rotationgizmov_labelcircley{fill:#4eeb10;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcircley:hover{opacity:0.7}.tp-rotationgizmov_labelcirclez{fill:#1068eb;cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclez:hover{opacity:0.7}.tp-rotationgizmov_labelcirclen{fill:var(--in-fg);cursor:pointer;pointer-events:auto}.tp-rotationgizmov_labelcirclen:hover{opacity:0.7}.tp-rotationgizmov_labeltext{fill:var(--btn-fg);stroke:var(--btn-fg);stroke-width:1px}.tp-rotationgizmov_p:focus .tp-rotationgizmov_m{background-color:var(--in-fg);border-width:0}",accept(t,e){if(!ie(t))return null;const i=w,n=function(t,e){const i=w.required.object(e)(t);return i.succeeded?i.value:void 0}(e,{view:i.required.constant("rotation"),label:i.optional.string,picker:i.optional.custom(nt),expanded:i.optional.boolean,rotationMode:i.optional.custom(ne),x:i.optional.custom(st),y:i.optional.custom(st),z:i.optional.custom(st),w:i.optional.custom(st)});return n?{initialValue:t,params:n}:null},binding:{reader:t=>t=>ie(t)?t:new dt,constraint:({params:t})=>new lt({assembly:Yt,components:[ee("x"in t?t.x:void 0),ee("y"in t?t.y:void 0),ee("z"in t?t.z:void 0),ee("w"in t?t.w:void 0)]}),writer:t=>(t,e)=>{t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z),t.writeProperty("w",e.w)}},controller({document:t,value:e,constraint:i,params:s,viewProps:o}){var r;if(!(i instanceof lt))throw n.shouldNeverHappen();const a=null!==(r=s.rotationMode)&&void 0!==r?r:"quaternion",l="expanded"in s?s.expanded:void 0,h="picker"in s?s.picker:void 0;return new Gt(t,{axes:[te(e.rawValue.x,i.components[0]),te(e.rawValue.y,i.components[1]),te(e.rawValue.z,i.components[2]),te(e.rawValue.w,i.components[3])],rotationMode:a,expanded:null!=l&&l,parser:Y,pickerLayout:null!=h?h:"popup",value:e,viewProps:o})}};t.RotationInputPlugin=se,t.plugin=se,Object.defineProperty(t,"__esModule",{value:!0})}));
